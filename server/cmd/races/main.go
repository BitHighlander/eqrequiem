// gen_race_names.go
// Run with `go run gen_race_names.go > race_names_generated.go`

package main

import (
	"bufio"
	"fmt"
	"os"
	"regexp"
)

func main() {
	in, err := os.Open("/Users/Paul/source/eqemu-server/common/races.cpp")
	if err != nil {
		panic(err)
	}
	defer in.Close()

	reCase := regexp.MustCompile(`case\s+Race::(\w+):`)
	reRet := regexp.MustCompile(`return\s+"([^"]+)"`)
	scanner := bufio.NewScanner(in)

	fmt.Println("package constants")
	fmt.Println()
	fmt.Println("// DO NOT EDITâ€”auto-generated by gen_race_names.go")
	fmt.Println("var raceNames = map[RaceID]string{")

	var last string
	for scanner.Scan() {
		line := scanner.Text()
		if m := reCase.FindStringSubmatch(line); m != nil {
			last = m[1]
		} else if m := reRet.FindStringSubmatch(line); m != nil && last != "" {
			fmt.Printf("\tRace%s: %q,\n", last, m[1])
			last = ""
		}
	}
	fmt.Println("}")
}
